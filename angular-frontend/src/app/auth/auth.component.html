
<div class="auth-container">
  <!-- Fondo animado -->
  <div class="animated-bg">
    <div class="wave wave-1"></div>
    <div class="wave wave-2"></div>
    <div class="wave wave-3"></div>
  </div>

  <!-- Card de autenticaciÃ³n -->
  <mat-card class="auth-card">
    <!-- Logo y encabezado -->
    <div class="auth-card__logo">
      <mat-icon class="logo-icon">pool</mat-icon>
    </div>

    <div class="auth-card__header">
      <mat-card-title>
        <span class="title-emoji">{{ mode === 'login' ? 'ðŸ‘‹' : 'ðŸŽ‰' }}</span>
        {{ mode === 'login' ? 'Bienvenido de vuelta' : 'Crear cuenta nueva' }}
      </mat-card-title>
      <mat-card-subtitle>
        {{ mode === 'login' ? 'Ingresa tus credenciales para continuar' : 'Ãšnete a SwimLive hoy' }}
      </mat-card-subtitle>
    </div>

    <!-- Formulario -->
    <form [formGroup]="authForm" (ngSubmit)="submit()" class="auth-form">
      <!-- Campo Nombre (solo en registro) -->
      @if (mode === 'register') {
        <mat-form-field appearance="outline" class="full-width">
          <mat-label>Nombre completo</mat-label>
          <input
            matInput
            formControlName="name"
            autocomplete="name"
            placeholder="Ej: Juan PÃ©rez" />
          <mat-icon matPrefix>person</mat-icon>
          @if (nameControl?.invalid && (nameControl?.touched || formSubmitted)) {
            <mat-error>{{ getErrorMessage('name') }}</mat-error>
          }
        </mat-form-field>
      }

      <!-- Campo Email -->
      <mat-form-field appearance="outline" class="full-width">
        <mat-label>Correo electrÃ³nico</mat-label>
        <input
          matInput
          type="email"
          formControlName="email"
          autocomplete="email"
          placeholder="tu@email.com" />
        <mat-icon matPrefix>email</mat-icon>
        @if (emailControl?.invalid && (emailControl?.touched || formSubmitted)) {
          <mat-error>{{ getErrorMessage('email') }}</mat-error>
        }
      </mat-form-field>

      <!-- Campo Confirmar Email (solo en registro) -->
      @if (mode === 'register') {
        <mat-form-field appearance="outline" class="full-width" [class.field-match]="emailsMatch()" [class.field-mismatch]="emailsDontMatch()">
          <mat-label>Confirmar correo electrÃ³nico</mat-label>
          <input
            matInput
            type="email"
            formControlName="confirmEmail"
            autocomplete="email"
            placeholder="tu@email.com" />
          <mat-icon matPrefix>email</mat-icon>
          @if (emailsMatch() && confirmEmailControl?.value) {
            <mat-icon matSuffix class="match-icon">check_circle</mat-icon>
          }
          @if (emailsDontMatch()) {
            <mat-icon matSuffix class="mismatch-icon">cancel</mat-icon>
          }
          @if ((confirmEmailControl?.invalid || authForm.hasError('emailMismatch')) && (confirmEmailControl?.touched || formSubmitted)) {
            <mat-error>{{ getErrorMessage('confirmEmail') }}</mat-error>
          }
          @if (confirmEmailControl?.value && !confirmEmailControl?.invalid) {
            <mat-hint [class.match-hint]="emailsMatch()" [class.mismatch-hint]="emailsDontMatch()">
              {{ emailsMatch() ? 'âœ“ Los correos coinciden' : 'âœ— Los correos no coinciden' }}
            </mat-hint>
          }
        </mat-form-field>
      }

      <!-- Campo ContraseÃ±a -->
      <mat-form-field appearance="outline" class="full-width">
        <mat-label>ContraseÃ±a</mat-label>
        <input
          matInput
          [type]="passwordVisible ? 'text' : 'password'"
          formControlName="password"
          [autocomplete]="mode === 'login' ? 'current-password' : 'new-password'"
          placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢" />
        <mat-icon matPrefix>lock</mat-icon>
        <button
          mat-icon-button
          matSuffix
          type="button"
          (click)="togglePasswordVisibility()"
          [attr.aria-label]="'Mostrar contraseÃ±a'"
          [attr.aria-pressed]="passwordVisible">
          <mat-icon>{{ passwordVisible ? 'visibility_off' : 'visibility' }}</mat-icon>
        </button>
        @if (passwordControl?.invalid && (passwordControl?.touched || formSubmitted)) {
          <mat-error>{{ getErrorMessage('password') }}</mat-error>
        }
      </mat-form-field>

      <!-- Campo Confirmar ContraseÃ±a (solo en registro) -->
      @if (mode === 'register') {
        <mat-form-field appearance="outline" class="full-width" [class.field-match]="passwordsMatch()" [class.field-mismatch]="passwordsDontMatch()">
          <mat-label>Confirmar contraseÃ±a</mat-label>
          <input
            matInput
            [type]="passwordVisible ? 'text' : 'password'"
            formControlName="confirmPassword"
            autocomplete="new-password"
            placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢" />
          <mat-icon matPrefix>lock</mat-icon>
          @if (passwordsMatch() && confirmPasswordControl?.value) {
            <mat-icon matSuffix class="match-icon">check_circle</mat-icon>
          }
          @if (passwordsDontMatch()) {
            <mat-icon matSuffix class="mismatch-icon">cancel</mat-icon>
          }
          @if ((confirmPasswordControl?.invalid || authForm.hasError('passwordMismatch')) && (confirmPasswordControl?.touched || formSubmitted)) {
            <mat-error>{{ getErrorMessage('confirmPassword') }}</mat-error>
          }
          @if (confirmPasswordControl?.value && !confirmPasswordControl?.invalid) {
            <mat-hint [class.match-hint]="passwordsMatch()" [class.mismatch-hint]="passwordsDontMatch()">
              {{ passwordsMatch() ? 'âœ“ Las contraseÃ±as coinciden' : 'âœ— Las contraseÃ±as no coinciden' }}
            </mat-hint>
          }
        </mat-form-field>
      }

      <!-- Enlace "OlvidÃ© mi contraseÃ±a" -->
      @if (mode === 'login') {
        <div class="forgot-password">
          <a routerLink="/forgot-password" class="forgot-link">Â¿Olvidaste tu contraseÃ±a?</a>
        </div>
      }

      <!-- BotÃ³n de envÃ­o -->
      <button
        mat-raised-button
        color="primary"
        class="submit-btn"
        type="submit"
        [disabled]="loading">
        @if (loading) {
          <mat-progress-spinner diameter="20" mode="indeterminate"></mat-progress-spinner>
        }
        @if (!loading) {
          <mat-icon>{{ mode === 'login' ? 'login' : 'person_add' }}</mat-icon>
        }
        <span>{{ loading ? 'Procesando...' : (mode === 'login' ? 'Iniciar sesiÃ³n' : 'Crear cuenta') }}</span>
      </button>
    </form>

    <!-- Mensajes de Ã©xito/error -->
    <div class="messages">
      @if (message) {
        <div class="message success" @fadeIn>
          <mat-icon>check_circle</mat-icon>
          <span>{{ message }}</span>
        </div>
      }
      @if (error) {
        <div class="message error" @fadeIn>
          <mat-icon>error</mat-icon>
          <span>{{ error }}</span>
        </div>
      }
    </div>

    <!-- Divisor -->
    <div class="divider">
      <span>o</span>
    </div>

    <!-- Switch entre login/registro -->
    <div class="switch">
      <span class="switch-text">
        {{ mode === 'login' ? 'Â¿No tienes cuenta?' : 'Â¿Ya tienes cuenta?' }}
      </span>
      <button
        mat-button
        color="primary"
        type="button"
        (click)="switchMode(mode === 'login' ? 'register' : 'login')">
        {{ mode === 'login' ? 'RegÃ­strate gratis' : 'Inicia sesiÃ³n' }}
      </button>
    </div>
  </mat-card>

  <!-- Footer -->
  <div class="auth-footer">
    <p>Â© 2025 SwimLive. Todos los derechos reservados.</p>
  </div>
</div>
