<h2 mat-dialog-title>Inscribir atletas</h2>

<mat-dialog-content>
  <div class="dialog-content">
    <!-- Búsqueda y filtros -->
    <div class="search-section">
      <mat-form-field appearance="outline" class="full-width">
        <mat-label>Buscar atleta</mat-label>
        <input matInput [formControl]="searchControl" placeholder="Nombre del atleta..." />
        <mat-icon matPrefix>search</mat-icon>
      </mat-form-field>

      <mat-form-field appearance="outline" class="full-width">
        <mat-label>Filtrar por género</mat-label>
        <mat-select [formControl]="genderControl">
          <mat-option value="">Todos</mat-option>
          <mat-option value="M">Masculino</mat-option>
          <mat-option value="F">Femenino</mat-option>
        </mat-select>
      </mat-form-field>

      <mat-form-field appearance="outline" class="full-width">
        <mat-label>País</mat-label>
        <input matInput [formControl]="countryControl" placeholder="Código país (ej: ESP)" />
      </mat-form-field>
    </div>

    <!-- Tabla de atletas -->
    <div class="table-section">
      @if (loading) {
        <div class="loading">
          <mat-progress-spinner mode="indeterminate"></mat-progress-spinner>
        </div>
      } @else if (filteredAthletes.length === 0) {
        <p class="no-data">No se encontraron atletas</p>
      } @else {
        <div class="table-container">
          <table mat-table [dataSource]="filteredAthletes" class="athletes-table">
            <!-- Checkbox column -->
            <ng-container matColumnDef="select">
              <th mat-header-cell *matHeaderCellDef>
                <mat-checkbox
                  [checked]="isAllSelected()"
                  (change)="toggleSelectAll($event)"
                ></mat-checkbox>
              </th>
              <td mat-cell *matCellDef="let element">
                <mat-checkbox
                  [checked]="element.selected"
                  (change)="toggleAthlete(element)"
                ></mat-checkbox>
              </td>
            </ng-container>

            <!-- Nombre -->
            <ng-container matColumnDef="athlete_name">
              <th mat-header-cell *matHeaderCellDef>Nombre</th>
              <td mat-cell *matCellDef="let element">{{ element.athlete_name }}</td>
            </ng-container>

            <!-- Género -->
            <ng-container matColumnDef="gender">
              <th mat-header-cell *matHeaderCellDef>Género</th>
              <td mat-cell *matCellDef="let element">
                {{ element.gender === 'M' ? 'Masculino' : 'Femenino' }}
              </td>
            </ng-container>

            <!-- País -->
            <ng-container matColumnDef="country_code">
              <th mat-header-cell *matHeaderCellDef>País</th>
              <td mat-cell *matCellDef="let element">{{ element.country_code }}</td>
            </ng-container>

            <!-- Edad -->
            <ng-container matColumnDef="age">
              <th mat-header-cell *matHeaderCellDef>Edad</th>
              <td mat-cell *matCellDef="let element">{{ element.age || '-' }}</td>
            </ng-container>

            <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
            <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
          </table>
        </div>
      }
    </div>

    <!-- Resumen de seleccionados -->
    @if (selectedAthletes.length > 0) {
      <div class="summary">
        <strong>{{ selectedAthletes.length }} atleta(s) seleccionado(s)</strong>
      </div>
    }
  </div>
</mat-dialog-content>

<mat-dialog-actions align="end">
  <button mat-button (click)="onCancel()">Cancelar</button>
  <button
    mat-raised-button
    color="primary"
    (click)="onSave()"
    [disabled]="selectedAthletes.length === 0 || saving"
  >
    @if (saving) {
      <mat-progress-spinner diameter="20" mode="indeterminate"></mat-progress-spinner>
    }
    <span>Inscribir ({{ selectedAthletes.length }})</span>
  </button>
</mat-dialog-actions>
